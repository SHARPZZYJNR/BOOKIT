<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Booking System</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <nav class="navbar">
        <div class="logo">BookIt.</div>
        <div>
            <button onclick="switchView('client')" class="nav-btn active" id="nav-client">Book</button>
            <button onclick="switchView('admin')" class="nav-btn" id="nav-admin">Admin</button>
        </div>
    </nav>

    <div class="container">

        <section id="client-view" class="view active">
            <header class="header">
                <h1>Book an Appointment</h1>
                <p>Select a service and time that works for you.</p>
            </header>

            <form id="booking-form">
                <div class="form-group">
                    <label for="service">Select Service</label>
                    <select id="service" required>
                        <option value="" disabled selected>Choose a service...</option>
                        <option value="Consultation">General Consultation (30 min)</option>
                        <option value="Therapy">Therapy Session (1 hr)</option>
                        <option value="Coaching">Career Coaching (45 min)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="date">Select Date</label>
                    <input type="date" id="date" required>
                </div>

                <div class="form-group" id="time-section" style="display:none;">
                    <label>Available Time Slots</label>
                    <div class="slots-grid" id="slots-container">
                    </div>
                    <input type="hidden" id="selected-time" required>
                    <p id="slot-error" class="error-msg"></p>
                </div>

                <div class="form-group" id="details-section" style="display:none;">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" placeholder="John Doe" required>

                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" placeholder="(555) 000-0000" required>
                </div>

                <button type="submit" id="submit-btn" disabled>Confirm Booking</button>
            </form>

            <div id="confirmation-msg" class="hidden">
                <div class="success-box">
                    <h3>Booking Confirmed! âœ…</h3>
                    <p>We have received your appointment.</p>
                    <button onclick="location.reload()">Book Another</button>
                </div>
            </div>
        </section>


        <section id="admin-view" class="view hidden">
            <header class="header">
                <h1>Admin Dashboard</h1>
                <p>Manage upcoming appointments.</p>
            </header>

            <div class="stats-cards">
                <div class="card">
                    <h3>Total</h3>
                    <span id="total-count">0</span>
                </div>
                <div class="card">
                    <h3>Revenue (Est.)</h3>
                    <span id="revenue-count">$0</span>
                </div>
            </div>

            <div class="table-container">
                <table id="bookings-table">
                    <thead>
                        <tr>
                            <th>Date & Time</th>
                            <th>Client</th>
                            <th>Service</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="bookings-list">
                    </tbody>
                </table>
                <p id="no-bookings" style="text-align:center; padding: 20px; color: #666;">No bookings found.</p>
            </div>
        </section>

    </div>

    <script>
        // --- CONFIGURATION ---
        const timeSlots = ["09:00", "10:00", "11:00", "12:00", "14:00", "15:00", "16:00", "17:00"];
        const STORAGE_KEY = 'appointmentBookings';

        // --- DOM ELEMENTS ---
        const dateInput = document.getElementById('date');
        const serviceInput = document.getElementById('service');
        const slotsContainer = document.getElementById('slots-container');
        const timeSection = document.getElementById('time-section');
        const detailsSection = document.getElementById('details-section');
        const selectedTimeInput = document.getElementById('selected-time');
        const bookingForm = document.getElementById('booking-form');
        const submitBtn = document.getElementById('submit-btn');

        // --- INITIALIZATION ---
        // Set min date to today
        dateInput.min = new Date().toISOString().split("T")[0];

        // --- EVENT LISTENERS ---
        dateInput.addEventListener('change', renderTimeSlots);
        serviceInput.addEventListener('change', () => {
            if (dateInput.value) renderTimeSlots();
        });

        bookingForm.addEventListener('submit', handleBookingSubmit);

        // --- CORE FUNCTIONS ---

        function getBookings() {
            return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        }

        function saveBooking(booking) {
            const bookings = getBookings();
            bookings.push(booking);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(bookings));
        }

        function renderTimeSlots() {
            const selectedDate = dateInput.value;
            const bookings = getBookings();

            // Filter bookings for the selected date
            const takenTimes = bookings
                .filter(b => b.date === selectedDate)
                .map(b => b.time);

            slotsContainer.innerHTML = '';
            selectedTimeInput.value = ''; // Reset selection

            timeSection.style.display = 'block';
            detailsSection.style.display = 'none'; // Hide details until slot picked
            submitBtn.disabled = true;

            timeSlots.forEach(time => {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'slot-btn';
                btn.textContent = time;

                if (takenTimes.includes(time)) {
                    btn.classList.add('disabled');
                    btn.disabled = true;
                    btn.title = "Already booked";
                } else {
                    btn.onclick = () => selectSlot(btn, time);
                }

                slotsContainer.appendChild(btn);
            });
        }

        function selectSlot(btn, time) {
            // Remove active class from all
            document.querySelectorAll('.slot-btn').forEach(b => b.classList.remove('selected'));

            // Add to clicked
            btn.classList.add('selected');
            selectedTimeInput.value = time;

            // Show details form
            detailsSection.style.display = 'block';
            submitBtn.disabled = false;

            // Smooth scroll to bottom
            setTimeout(() => {
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            }, 100);
        }

        function handleBookingSubmit(e) {
            e.preventDefault();

            const newBooking = {
                id: Date.now(),
                service: serviceInput.value,
                date: dateInput.value,
                time: selectedTimeInput.value,
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value,
                createdAt: new Date().toISOString()
            };

            saveBooking(newBooking);

            // UI Feedback
            bookingForm.style.display = 'none';
            document.getElementById('confirmation-msg').classList.remove('hidden');

            // Refresh Admin view if open (optional)
            renderAdminDashboard();
        }

        // --- ADMIN FUNCTIONS ---

        function switchView(viewName) {
            document.querySelectorAll('.view').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));

            document.getElementById(`${viewName}-view`).classList.remove('hidden');
            document.getElementById(`${viewName}-view`).classList.add('active');
            document.getElementById(`nav-${viewName}`).classList.add('active');

            if (viewName === 'admin') renderAdminDashboard();
        }

        function renderAdminDashboard() {
            const bookings = getBookings();
            const list = document.getElementById('bookings-list');
            const noData = document.getElementById('no-bookings');
            const totalCount = document.getElementById('total-count');
            const revenueCount = document.getElementById('revenue-count');

            list.innerHTML = '';
            totalCount.textContent = bookings.length;
            revenueCount.textContent = `$${bookings.length * 50}`; // Dummy revenue logic

            if (bookings.length === 0) {
                noData.style.display = 'block';
                return;
            } else {
                noData.style.display = 'none';
            }

            // Sort by date/time
            bookings.sort((a, b) => new Date(a.date + 'T' + a.time) - new Date(b.date + 'T' + b.time));

            bookings.forEach(b => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="date-cell">
                            <span class="fw-bold">${b.date}</span>
                            <span class="text-muted">${b.time}</span>
                        </div>
                    </td>
                    <td>
                        <div class="client-cell">
                            <span class="fw-bold">${b.name}</span>
                            <span class="text-small">${b.phone}</span>
                        </div>
                    </td>
                    <td><span class="badge">${b.service}</span></td>
                    <td>
                        <button class="btn-delete" onclick="deleteBooking(${b.id})">Delete</button>
                    </td>
                `;
                list.appendChild(row);
            });
        }

        function deleteBooking(id) {
            if (!confirm('Are you sure you want to delete this booking?')) return;

            const bookings = getBookings().filter(b => b.id !== id);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(bookings));
            renderAdminDashboard();
        }
    </script>
</body>

</html>